The Nautilus application development team is planning to launch a new PHP-based application, which they want to deploy on Nautilus infra in Stratos DC. The development team had a meeting with the production support team and they have shared some requirements regarding the infrastructure. Below are the requirements they shared:

a. Install nginx on app server 1 , configure it to use port 8097 and its document root should be /var/www/html.
b. Install php-fpm version 8.3 on app server 1, it must use the unix socket /var/run/php-fpm/default.sock (create the parent directories if don't exist).
c. Configure php-fpm and nginx to work together.
d. Once configured correctly, you can test the website using curl http://stapp01:8097/index.php command from jump host.
NOTE: We have copied two files, index.php and info.php, under /var/www/html as part of the PHP-based application setup. Please do not modify these files.

Solution:
Install nginx: yum install nginx -y
change the port and root :
  vi /etc/nginx/nginx.conf
  server {
        listen       8097;
        listen       [::]:8097;
        server_name  stapp03;
        root         /var/www/html;
        index index.html index.php;
        location / {
           try_files $uri $uri/ =404;
        }
        location ~ \.php$ {
           include fastcgi_params;
           fastcgi_pass unix:/var/run/php-fpm/default.sock;
           fastcgi_index index.php;
           fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }

Install php-fpm:
sudo dnf install epel-release
sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-9.rpm

sudo dnf module enable php:remi-8.2
sudo dnf install php-fpm php-cli php-mysqlnd php-gd php-xml php-mbstring
sudo systemctl start php-fpm
sudo systemctl enable php-fpm

Edited /etc/php-fpm.d/www.conf:
- listen = /var/run/php-fpm/default.sock
- listen.owner = apache
- listen.group = apache
- listen.mode = 0660

sudo mkdir -p /var/run/php-fpm
sudo chown -R apache:apache /var/run/php-fpm
  

sudo systemctl enable --now php-fpm

curl http://stapp02:8096/index.php
